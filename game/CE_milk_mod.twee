:: CE_milk_mod [widget]

<<widget "milk_released_setting">>
<div class="dol-settings dol-shadow">

    <div class="dol-header">
        <span class="dol-title">å¤§é‡æ“ ğŸ¥›æ¨¡å¼</span>
    </div>
    <div class="dol-body">

        <div class="dol-desc">
            ä¸€æ¬¡æ“ å‡ºæ›´å¤šçš„ğŸ¥›ï¼Œé–‹å•Ÿå¾Œè¨˜å¾—è¼¸å…¥å¤§é‡æ“ ğŸ¥›ä¸Š/ä¸‹é™ã€‚
        </div>
        <br>

        <<if $milk_releasedswich is undefined>>
            <<set $milk_releasedswich to 0>>
        <</if>>

        <div class="dol-btn"><<button "å¤§é‡æ“ ğŸ¥›æ¨¡å¼">>
            <<set $milk_releasedswich = $milk_releasedswich == 0 ? 1 : 0>>        
            <<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>
        <</button>></div>

        <<if $milk_releasedswich is 0>>
            <<set $milk_releasedFIX to 0>>
            <<set $milk_releasedFIX_MIN to 0>>
            <<set $milk_releasedFIX_MAX to 0>>
        <</if>>
        <<if $milk_releasedswich is 1>>
            <<set $milk_releasedFIX to random($milk_releasedFIX_MIN, $milk_releasedFIX_MAX) >>
        <</if>>

        <br><br>
        å¤§é‡æ“ ğŸ¥›æ¨¡å¼ï¼š
        <<if $milk_releasedswich is 0>>
            <span class="dol-red">é—œ</span>
        <</if>>
        <<if $milk_releasedswich is 1>>
            <span class="dol-green">é–‹</span>
        <</if>>

        <br><br>
        <hr>
        <div class="dol-section">
          
            <div class="dol-desc">åœ¨æ­¤è¨­å®šå¤§é‡æ“ ğŸ¥›ä¸‹é™ï¼š</div>
            <<numberslider "$milk_releasedFIX_MIN" $milk_releasedFIX_MIN 0 6000 100 >><br>    
            <div class="dol-desc">åœ¨æ­¤è¨­å®šå¤§é‡æ“ ğŸ¥›ä¸Šé™ï¼š</div>
            <<numberslider "$milk_releasedFIX_MAX" $milk_releasedFIX_MAX 0 6000 100>><br>

            <span class="dol-link"><<link "è¨­å®š">>
                <<if $milk_releasedswich is 0>>
                    <<set $milk_releasedFIX_MIN to 0>>
                    <<set $milk_releasedFIX_MAX to 0>>
                <</if>>        
                <<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>
            <</link>></span>

            <br>
            <div class="dol-desc">ç•¶å‰å¤§é‡æ“ ğŸ¥›ä¿®æ­£äº‚æ•¸ï¼š<span class="dol-blue">$milk_releasedFIX</span>mL</div>
            <hr>

            <div class="dol-desc">ä¿®æ”¹ğŸ¥›é‡</div>
           
            <<silently>>
                <<set $milk_max = Math.clamp($milk_max, 3000, 60000)>>                
                <<set $milk_volume = Math.clamp($milk_volume, 0, $milk_max)>> 
                <<set $milk_amount = Math.clamp($milk_amount, 0, $milk_volume)>>               
            <</silently>>
            
            <!--
            <div class="dol-desc">ç•¶å‰ğŸ¥›é‡æœ€å¤§å€¼ï¼š<span class="dol-blue">$milk_max mL</span></div>
            <<numberslider "$milk_max" $milk_max 3000 60000 100 >><br>
            <div class="dol-desc">ç•¶å‰å¯ä»¥å„²å­˜å¤šå°‘ğŸ¥›ï¼š<span class="dol-blue">$milk_volume</span>mL</div>
            <<numberslider "$milk_volume" $milk_volume 0 $milk_max 1>><br>
            <div class="dol-desc">ç•¶å‰æœ‰å¤šå°‘ğŸ¥›ï¼š<span class="dol-blue">$milk_amount</span>mL</div>
            <<numberslider "$milk_amount" $milk_amount 0 $milk_volume 1>><br>
            -->
            
            <!-- æ¯ä¹³æœ€å¤§é‡ -->
            <<numberStepper "ç•¶å‰ğŸ¥›é‡æœ€å¤§å€¼" $milk_max {
                callback: value => {
                    $milk_max = value;
                    $milk_volume = Math.min($milk_volume, $milk_max);
                    $milk_amount = Math.min($milk_amount, $milk_volume);
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>");
                },
                step: 100,
                valueFormat: value => value + "ml",
                min: 3000,
                max: 60000              
            }>><br>

            <!-- å¯å„²å­˜é‡ -->
            <<numberStepper "ç•¶å‰å¯ä»¥å„²å­˜å¤šå°‘ğŸ¥›" $milk_volume {
                callback: value => {
                    $milk_volume = value;
                    $milk_amount = Math.min($milk_amount, $milk_volume);
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>");
                },
                step: 10,
                valueFormat: value => value + "ml",
                min: 30,
                max: $milk_max             
            }>><br>

            <!-- ç•¶å‰æœ‰é‡ -->
            <<numberStepper "ç•¶å‰æœ‰å¤šå°‘ğŸ¥›" $milk_amount {
                callback: value => {
                    $milk_amount = value;
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>");
                },
                step: 10,
                valueFormat: (value, percentage) => `<b>${Math.round(percentage)}%</b> (${Math.round(value)}ml)`,
                min: 0,
                max: $milk_volume            
            }>><br>

            <span class="dol-link"><<link "è¨­å®š">>
                <<CE_milk_fix $milk_max $milk_volume>>
                <<replace #CE_settingsDiv>><<milk_released_setting>><br><br><</replace>>
            <</link>></span>
        </div>
    </div>
</div>
<</widget>>

<<widget "CE_milk_fix">>
    <<if !$CE_milk_max or !$CE_milk_volume>>
        <<set $CE_milk_max to $milk_max>>
        <<set $CE_milk_volume to $milk_volume>>      
    <</if>>
    <<if _args[0]>>
        <<set $CE_milk_max to _args[0]>>
        <<set $CE_milk_volume to _args[1]>>
    <</if>>
    <<if $milk_max != $CE_milk_max or $milk_volume != $CE_milk_volume>>
        <<if $milk_releasedswich is 1>> 
            <<set $milk_max to $CE_milk_max>>
            <<set $milk_volume to $CE_milk_volume>>
        <</if>>    
    <</if>>
<</widget>>

<<widget "milk_releasedFIX">>
    <<if $milk_releasedswich is undefined or $milk_releasedswich is 0>>
        <<set $milk_releasedFIX to 0 >>
    <<else>>
        <<if $milk_releasedFIX_MIN is undefined>>
            <<set $milk_releasedFIX_MIN to 10 >>
        <</if>>
        <<if $milk_releasedFIX_MAX is undefined>>
            <<set $milk_releasedFIX_MAX to 10 >>
        <</if>>
        <<set $milk_releasedFIX to random($milk_releasedFIX_MIN,$milk_releasedFIX_MAX) - _args[0]>>
        <<if $milk_amount lt $milk_releasedFIX>>
            <<set $milk_releasedFIX to $milk_amount - _args[0]>>
        <</if>>
    <</if>>    
<</widget>>

<<widget "semen_released_setting">>
<div class="dol-settings dol-shadow">

    <<if $semen_releasedFIX is undefined>>
        <<set $semen_releasedFIX to 1>>
    <</if>>

    <div class="dol-header">
        <span class="dol-title">å¤§çˆ†ğŸæ¨¡å¼</span>
    </div>
    <div class="dol-body">

        <div class="dol-desc">ä¸€æ¬¡ğŸå‡ºæ›´å¤šçš„ğŸ¼ï¼ŒPcå·²ç¶“æ²–æšˆåœ¨å»æ‰€ã€‚</div>
        <br>

        <<if $semen_releasedswich is undefined>>
            <<set $semen_releasedswich to 0>>
        <</if>>
        <<if !$semen_releasedswich>>
            <<set $semen_releasedFIX to 1>>
        <</if>>

        <div class="dol-btn"><<button "å¤§çˆ†ğŸæ¨¡å¼">>
            <<set $semen_releasedswich = $semen_releasedswich == 0 ? 1 : 0>>        
            <<replace #CE_settingsDiv>><<semen_released_setting>><br><br><</replace>>
        <</button>></div>

        <br><br>
        å¤§çˆ†ğŸæ¨¡å¼ï¼š
        <<if $semen_releasedswich is 0>>
            <span class="dol-red">é—œ</span>
        <</if>>
        <<if $semen_releasedswich is 1>>
            <span class="dol-green">é–‹</span>
        <</if>>

        <br><br><hr>
        <div class="dol-section">
            <div class="dol-desc">ä¿®æ”¹ğŸ¼é‡</div>

            <<silently>>
                <<set $semen_max    = Math.clamp($semen_max, 3000, 60000)>>
                <<set $semen_volume = Math.clamp($semen_volume, 30, $semen_max)>>                
                <<set $semen_amount = Math.clamp($semen_amount, 0, $semen_volume)>>               
            <</silently>>

            <!--
            <div class="dol-desc">ç•¶å‰ğŸ¼é‡æœ€å¤§å€¼ï¼š<span class="dol-blue">$semen_max mL</span></div>
            <<numberslider "$semen_max" $semen_max 3000 60000 100 >><br>
            <div class="dol-desc">ç•¶å‰å¯ä»¥å„²å­˜å¤šå°‘ğŸ¼ï¼š<span class="dol-blue">$semen_volume</span>mL</div>
            <<numberslider "$semen_volume" $semen_volume 30 $semen_max 1>><br>
            <div class="dol-desc">ç•¶å‰æœ‰å¤šå°‘ğŸ¼ï¼š<span class="dol-blue">$semen_amount</span>mL</div>
            <<numberslider "$semen_amount" $semen_amount 0 $semen_volume 1>><br><br>
            -->
            
            <!-- ç²¾æ¶²æœ€å¤§é‡ -->
            <<numberStepper "ç•¶å‰ğŸ¼é‡æœ€å¤§å€¼" $semen_max {
                callback: value => {
                    $semen_max = value;
                    $semen_volume = Math.min($semen_volume, $semen_max);
                    $semen_amount = Math.min($semen_amount, $semen_volume);
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<semen_released_setting>><br><br><</replace>>");
                },
                step: 100,
                valueFormat: value => value + "ml",
                min: 3000,
                max: 60000
               
            }>><br>

            <!-- å¯å„²å­˜é‡ -->
            <<numberStepper "ç•¶å‰å¯ä»¥å„²å­˜å¤šå°‘ğŸ¼" $semen_volume {
                callback: value => {
                    $semen_volume = value;
                    $semen_amount = Math.min($semen_amount, $semen_volume);
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<semen_released_setting>><br><br><</replace>>");
                },
                step: 10,
                valueFormat: value => value + "ml",
                min: 30,
                max: $semen_max
               
            }>><br>

            <!-- ç•¶å‰æœ‰é‡ -->
            <<numberStepper "ç•¶å‰æœ‰å¤šå°‘ğŸ¼" $semen_amount {
                callback: value => {
                    $semen_amount = value;
                    Wikifier.wikifyEval("<<replace #CE_settingsDiv>><<semen_released_setting>><br><br><</replace>>");
                },
                step: 10,
                valueFormat: (value, percentage) => `<b>${Math.round(percentage)}%</b> (${Math.round(value)}ml)`,
                min: 0,
                max: $semen_volume
            }>><br>

            <<set _semen_released to calculateSemenReleased()>>
            <hr>
            <div class="dol-desc">ç•¶å‰ğŸç²¾é‡ï¼š<span class="dol-blue">_semen_released</span></div>
            ğŸç²¾å€æ•¸ï¼š<<numberslider "$semen_releasedFIX" $semen_releasedFIX 1 100 1>><br>

            <span class="dol-link">
                <<link "è¨­å®š">>
                    <<if !$semen_releasedswich>>
                        <<set $semen_releasedFIX to 1>>
                    <</if>>
                    <<CE_semen_fix $semen_max $semen_volume>>    
                    <<replace #CE_settingsDiv>><<semen_released_setting>><br><br><</replace>>
                <</link>>
            </span>
        </div>
    </div>
</div>
<</widget>>

<<widget "CE_semen_fix">>
    <<if !$CE_semen_max or !$CE_semen_volume>>
        <<set $CE_semen_max to $semen_max>>
        <<set $CE_semen_volume to $semen_volume>>      
    <</if>>
    <<if _args[0]>>
        <<set $CE_semen_max to _args[0]>>
        <<set $CE_semen_volume to _args[1]>>
    <</if>>
    <<if $semen_max != $CE_semen_max or $semen_volume != $CE_semen_volume>>
        <<if $semen_releasedswich is 1>> 
            <<set $semen_max to $CE_semen_max>>
            <<set $semen_volume to $CE_semen_volume>>
        <</if>>    
    <</if>>
<</widget>>